---
import BaseLayout from '../../layouts/BaseLayout.astro';

const title = 'Blog';
  const description = 'Entdecke die neuesten News, Tutorials und Best Practices im Bereich AI-Automation Engineering von unserer Experten-Community.';

// Load all blog posts from date-based folders (only index.md files)
const modules = import.meta.glob('./*/index.md', { eager: true });
const allPosts = Object.entries(modules).map(([path, module]) => {
  const mod = module as any; // Type assertion for Astro module
  return {
    frontmatter: mod.frontmatter || {},
    url: path.replace('./', '/blog/').replace('/index.md', '/')
  };
});

// Process and sort blog posts
const blogPosts = allPosts.filter(post => {
  const frontmatter = post.frontmatter || {};
  const url = post.url;
  
  // Extract date from folder name or use frontmatter date
  const folderMatch = url?.match(/\/(\d{4}-\d{2}-\d{2})-/);
  const dateFromFolder = folderMatch ? folderMatch[1] : null;
  
  // Use pubDate from frontmatter or publishDate, fallback to folder date
  const publishDate = frontmatter.pubDate || frontmatter.publishDate || dateFromFolder;
  
  // Only include posts with valid dates
  return !!publishDate;
}).map(post => {
  const frontmatter = post.frontmatter || {};
  const url = post.url;
  
  // Extract date from folder name or use frontmatter date
  const folderMatch = url?.match(/\/(\d{4}-\d{2}-\d{2})-/);
  const dateFromFolder = folderMatch ? folderMatch[1] : null;
  
  // Use pubDate from frontmatter or publishDate, fallback to folder date
  const publishDate = frontmatter.pubDate || frontmatter.publishDate || dateFromFolder;
  
  return {
    id: url?.split('/').slice(-2, -1)[0] || 'unknown', // Get folder name as ID
    title: frontmatter.title || 'Untitled',
    excerpt: frontmatter.description || 'No description available',
    publishDate: publishDate!,
    readTime: frontmatter.readTime || '5 min read',
    category: frontmatter.category || 'General',
    author: frontmatter.author || 'Anonymous',
    image: frontmatter.image || 'https://images.pexels.com/photos/3861969/pexels-photo-3861969.jpeg?auto=compress&cs=tinysrgb&w=600&h=400&dpr=2',
    tags: frontmatter.tags || [],
    url: url
  };
}).sort((a, b) => {
  // Sort by publish date (newest first)
  return new Date(b.publishDate).getTime() - new Date(a.publishDate).getTime();
});

// Blog posts are ready to display
---

<BaseLayout {title} {description}>
  <!-- Hero Section -->
  <section class="relative min-h-[60vh] bg-white overflow-hidden">
    <!-- Background Animation -->
    <div class="absolute inset-0 bg-gradient-to-br from-gray-50 via-white to-green-50">
      <div class="absolute inset-0 bg-grid-slate-100 [mask-image:linear-gradient(0deg,white,rgba(255,255,255,0.6))]"></div>
      <!-- Floating animation elements -->
      <div class="absolute top-1/4 left-1/4 w-48 h-48 bg-green-100 rounded-full mix-blend-multiply filter blur-xl opacity-50 animate-blob"></div>
      <div class="absolute top-1/3 right-1/4 w-56 h-56 bg-blue-100 rounded-full mix-blend-multiply filter blur-xl opacity-50 animate-blob animation-delay-2000"></div>
    </div>

    <div class="relative z-10 max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-20">
      <div class="text-center">
        <!-- Main Headline -->
        <h1 class="text-6xl sm:text-7xl lg:text-8xl xl:text-9xl font-bold tracking-tight mb-8 animate-fade-in leading-none">
          <span class="block text-gray-900">News, Tutorials,</span>
          <span class="block bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">Insights.</span>
        </h1>
        
        <!-- Subtitle -->
        <p class="text-xl sm:text-2xl text-gray-600 mb-16 max-w-3xl mx-auto font-light leading-relaxed animate-fade-in animation-delay-300">
          News, Tutorials und Best Practices von<br>
          unserer Experten-Community.
        </p>
      </div>
    </div>
  </section>

  <!-- Blog Grid -->
  <section class="py-16 bg-white">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8">
        {blogPosts.map((post, index) => (
          <article class="group animate-fade-in-up" style={`animation-delay: ${index * 100}ms`}>
            <a href={post.url} class="block">
              <div class="aspect-[4/3] bg-gray-100 rounded-2xl overflow-hidden mb-6 group-hover:scale-105 transition-transform duration-300">
                <img 
                  src={post.image} 
                  alt={post.title}
                  class="w-full h-full object-cover"
                  loading="lazy"
                />
              </div>
              <div class="space-y-4">
                <div class="flex items-center justify-end">
                  <span class="text-sm text-gray-500">
                    {post.readTime}
                  </span>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 group-hover:text-blue-600 transition-colors leading-tight">
                  {post.title}
                </h2>
                <p class="text-gray-600 leading-relaxed">
                  {post.excerpt}
                </p>
                <div class="flex items-center text-sm text-gray-500">
                  <span>{post.author}</span>
                  <span class="mx-2">â€¢</span>
                  <span>
                    {new Date(post.publishDate).toLocaleDateString('de-DE', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric'
                    })}
                  </span>
                </div>
              </div>
            </a>
          </article>
        ))}
      </div>

      <!-- Load More Button -->
      <div class="text-center mt-20">
        <button class="inline-flex items-center px-8 py-4 text-lg font-semibold text-gray-900 bg-white border-2 border-gray-200 rounded-full hover:border-gray-900 transition-all duration-300">
          Weitere Artikel laden
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
          </svg>
        </button>
      </div>
    </div>
  </section>

  <!-- Newsletter Signup -->
  <section class="py-32 bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-4xl sm:text-5xl font-bold text-gray-900 mb-8">
        Bleibe informiert.
      </h2>
      <p class="text-xl text-gray-600 mb-12">
        Abonniere unseren Newsletter und verpasse keine KI-Automatisierungs-Insights
      </p>
      <form class="max-w-lg mx-auto flex flex-col sm:flex-row gap-4">
        <input 
          type="email" 
          placeholder="Deine E-Mail-Adresse"
          class="flex-1 px-6 py-4 text-lg border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-gray-900 focus:border-transparent"
          required
        >
        <button type="submit" class="px-8 py-4 text-lg font-semibold text-white bg-gray-900 rounded-full hover:bg-gray-800 transition-all duration-300 shadow-lg hover:shadow-xl">
          Abonnieren
        </button>
      </form>
    </div>
  </section>
</BaseLayout>
