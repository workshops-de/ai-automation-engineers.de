name: Issue Analysis with Claude

on:
  issues:
    types: [opened]

jobs:
  analyze-issue:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Analyze Issue with Claude
        uses: anthropics/claude-code-action@main
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          prompt: |
            Analysiere das folgende Issue und erstelle einen strukturierten Bericht.

            REPO: ${{ github.repository }}
            ISSUE_NUMBER: ${{ github.event.issue.number }}

            Du bist ein technischer Analyst, der GitHub Issues auf Qualit√§t und Vollst√§ndigkeit √ºberpr√ºft.

            **Analyse-Kriterien:**

            1. **User Story Struktur:**
               - Ist eine User Story vorhanden?
               - Folgt sie dem Format: "Als [Rolle] m√∂chte ich [Funktionsanforderung], um [Mehrwert f√ºr Rolle]"?
               - Sind Rolle, Funktionsanforderung und Mehrwert klar definiert?

            2. **Code-Relevanz:**
               - Gibt es einen erkennbaren Bezug zu existierendem Code?
               - Welche Komponenten/Module sind betroffen?
               - Basierend auf der Projektstruktur (Astro, React, Firebase): Wo w√ºrde die Implementierung stattfinden?

            3. **Vollst√§ndigkeit:**
               - Sind alle notwendigen Informationen vorhanden?
               - Welche L√ºcken existieren in der Beschreibung?
               - Fehlen Akzeptanzkriterien oder technische Details?

            4. **Wichtige √úberlegungen:**
               - Was sollte bei der Implementierung bedacht werden?
               - Gibt es Abh√§ngigkeiten zu anderen Features?
               - Welche Auswirkungen hat das Feature auf andere Systemteile?

            5. **Sicherheitsrisiken:**
               - Welche Sicherheitsaspekte m√ºssen beachtet werden?
               - Gibt es potenzielle Schwachstellen?
               - Sind Authentifizierung/Autorisierung betroffen?

            **Bitte erstelle einen Kommentar im Issue mit folgendem Format:**

            ## ü§ñ Automatische Issue-Analyse durch Claude

            ## üìã Issue-Qualit√§tsbewertung

            ‚úÖ **Qualit√§t:** [AUSREICHEND / VERBESSERUNGSBEDARF]

            ## üéØ User Story Analyse

            [Bewertung der User Story Struktur]

            ## üîç Code-Relevanz

            [Analyse des Code-Bezugs und betroffener Komponenten]

            ## ‚ö†Ô∏è Fehlende Informationen

            [Liste der L√ºcken in der Beschreibung]

            ## üí° Implementierungshinweise

            [Wichtige √úberlegungen f√ºr die Implementierung]

            ## üîí Sicherheitsaspekte

            [Identifizierte Sicherheitsrisiken und Empfehlungen]

            ## üöÄ N√§chste Schritte

            [Wenn AUSREICHEND: Label "ready-for-implementation" setzen und Feature Branch Name vorschlagen]
            [Wenn VERBESSERUNGSBEDARF: Label "needs-clarification" setzen und konkrete Fragen stellen]

            ---
            *Diese Analyse wurde automatisch erstellt.*
          allowed_non_write_users: "*"

